<!DOCTYPE html>
<html lang="en">
<head>
    <title>Symbolization</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />

    <!--animation-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">

    <!--facebook and info icons-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!--use a better font for this web map-->
    <link href="https://fonts.googleapis.com/css?family=Lato|Open+Sans" rel="stylesheet">


    <link rel="stylesheet" type="text/css" href="../../css/storymap.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <!--add favicon for the web page-->
    <link rel="shortcut icon" href="../../img/favicon.ico" type="image/x-icon">
    <!--add required libraries-->
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
    <script src="https://cdn.bootcss.com/chroma-js/1.3.3/chroma.min.js"></script>
    <script src="js/bouncemarker.js"></script>


    <!--story map plugin-->
    <script src="../../js/storymap.js"></script>

</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-6 col-md-4 main">
            <section data-scene="scene1">
                <h2>Default Style</h2>
            </section>
            <section data-scene="scene2">
                <h2>Total Population</h2>
                <h5><i><b>Definition:</b> The total number of individuals living within a county’s designated boundaries.</i></h5>
                <p>Population size provides insight into the nature of a county’s
                  residential communities. This measure is also important for tracking
                  growth or declines within a specific county and making comparisons
                  across counties.</P>
                <p>Changes in population occur through births, deaths
                   and migration. Such shifts can indicate whether a county is attracting
                   new residents, or when an economy is struggling or prosperous. Total
                   population as a measure also helps in planning for current and future
                   community needs. </p>
            </section>
            <section data-scene="scene3">
                <h2>Rural Population</h2>
                <h5><i><b>Definition:</b> The percentage of people who reside outside of Census-designated urban areas or clusters in a given county.</i></h5>
                <p> Rural communities, especially those defined as rural according to the
                    U.S. Census guidelines, present significantly different contexts from
                    their urban and suburban counterparts. The strengths, needs and
                    capacities of rural communities differ accordingly.</p>
                <p>In Oregon, where there are only 12 cities with population greater than 50,000, knowing
                   the proportion of the rural population in a county allows decision
                   makers to develop more balanced strategies to support different types
                   of communities. </p>
            </section>
            <section data-scene="scene4">
                <h2>Net Migration</h2>
                <h5><i><b>Definition:</b> Net migration is the change in population due to people moving in or out of a given area over a specified time period per 1,000 residents.<i></h5>
                <p>A positive net migration means more people are moving into a county
                   than are leaving, while a negative value means more people are
                   moving out of a county than moving in. </p>
                <p>Overall, urban areas in Oregon tend to have higher rates of net migration than in rural, but there are
                   exceptions for individual counties. It is important for businesses and
                   local leaders to understand net migration in order to anticipate the
                   county’s future demands.</p>
                <p> Population growth resulting from migration requires different resources than growth caused by natural increase.
                    Understanding the various contributors to population change is
                    important for long-range planning</p>
            </section>
            <section data-scene="scene5">
                <h2>Housing Cost Burden</h2>
                <h5><i><b>Definition:</b> The percentage of households, both renters and owners, paying 30% or greater of their income on rent or mortgage.</i> </h5>
                <p>Housing cost burden provides a measure of a county’s affordability. The
                   Department of Housing and Urban Development (HUD) has established
                   the “30 percent rule,” meaning that households should spend no more
                   than 30 percent of their income on housing.</p>
                <p>Some criticize the rule
                   for being oversimplified. For example, it does not take into account
                   income level. Still, housing cost burden provides a measure of the
                   number of households that may be at risk of eviction, foreclosure,
                   and/or homelessness.</p>
                <p>This measure is a key success indicator for
                   affordable housing efforts. Those facing housing cost burden also may
                   face challenges spending money in other domains, including food,
                   transportation, health or education.</p>
            </section>
            <section data-scene="scene6">
                <h2>Scene 6</h2>
                <p>Inspired by the post on <a href="https://adventuresinmapping.com/2016/10/17/firefly-cartography/" target="_blank">Firefly Cartography</a>.</p>
            </section>
        </div>
        <div id="map" class="col-sm-6 col-md-8 sidebar"></div>
    </div>
    <!--add a scrolling down arrow-->
    <div class="animated flash infinite glyphicon glyphicon-menu-down arrow-down"></div>
    <!--add a navigation bar-->
    <div class="navwidget text-center"></div>
</div>
<script type="text/javascript">

    //////////////////////////////////////////////////////////////////////////
    // Scene 1: Plain
    var counties_legend ='<i style="background: black; opacity: 0.5"></i><p><b>Counties</b></p>';
    var counties = L.geoJson.ajax('../../assets/counties.geojson',  {
        color: 'black',
        weight: 2,
        opacity: 0.3});

    //////////////////////////////////////////////////////////////////////////
    // Scene 2: Total Population Choropleth
    // Set function for color ramp
    function setColor(density){
        //Tenary operation: condition ? valueIfTrue : valueIfFalse
        // condition ? value1 : value2
        return  density > 250000 ? '#b30000' :
                density > 100000 ? '#e34a33' :
                density > 50000 ? '#fc8d59' :
                density >  10000 ? '#fdcc8a' :
                '#fef0d9';
    }

    // Set style function that sets fill color property equal to Total Population
    function style(feature) {
        return {
            fillColor: setColor(feature0.properties.Total_Popu),
            fillOpacity: 0.5,
            weight: 2,
            opacity: 0.8,
            color: '#605f5f',
            dashArray: '4'
        };
    }

    var counties_choropleth = L.geoJson.ajax('../../assets/counties.geojson',
        {
            style: style,
            onEachFeature: function (feature, layer) {
                layer.bindTooltip(feature.properties.altName+"<br> Total Pop: "+feature.properties.Total_Popu , {className: 'feature-label', permanent: false, direction: 'center'});
            }
        });


    var counties_choropleth_legend = '<p><b>Total Population</b></p>' +
        '<i style="background: #fef0d9; opacity: 0.5"></i><p><b>0 - 10,000</b></p>' +
        '<i style="background: #fdcc8a; opacity: 0.5"></i><p><b>10,001 - 50,000</b></p>' +
        '<i style="background: #fc8d59; opacity: 0.5"></i><p><b>50,001 - 100,000</b></p>' +
        '<i style="background: #e34a33; opacity: 0.5"></i><p><b>100,001 - 250,000</b></p>' +
        '<i style="background: #b30000; opacity: 0.5"></i><p><b>>250,000</b></p>';

    //////////////////////////////////////////////////////////////////////////
    // Scene 3: Rural Population Percentage

    // Set function for color ramp
    function setColor(density){
        //Tenary operation: condition ? valueIfTrue : valueIfFalse
        // condition ? value1 : value2
        return  density > 100 ? '#b30000' :
                density > 75 ? '#e34a33' :
                density > 50 ? '#fc8d59' :
                density > 25 ? '#fdcc8a' :
                '#fef0d9';
    }

    // Set style function that sets fill color property equal to percentage of rural population
    function style(feature) {
        return {
            fillColor: setColor(feature.properties.Rural_Popu),
            fillOpacity: 0.5,
            weight: 2,
            opacity: 0.8,
            color: '#605f5f',
            dashArray: '4'
        };
    }

    var counties_ruralpop_choropleth = L.geoJson.ajax('../../assets/counties.geojson',
        {
            style: style,
            onEachFeature: function (feature, layer) {
                layer.bindTooltip(feature.properties.altName+"<br> Rural Population: "+ (feature.properties.Rural_Popu).toFixed(2) + "%", {className: 'feature-label', permanent: false, direction: 'center'});
            }
        });


    var counties_ruralpop_choropleth_legend = '<p><b>Rural Population</b></p>' +
        '<i style="background: #fef0d9; opacity: 0.5"></i><p><b>0% - 25%</b></p>' +
        '<i style="background: #fdcc8a; opacity: 0.5"></i><p><b>25.1% - 50%</b></p>' +
        '<i style="background: #fc8d59; opacity: 0.5"></i><p><b>50.1% - 75%</b></p>' +
        '<i style="background: #e34a33; opacity: 0.5"></i><p><b>75.1% - 100%</b></p>';

    //////////////////////////////////////////////////////////////////////////
    // Scene 4: Net Migration

    // Set function for color ramp
    function setColor(density){
        //Tenary operation: condition ? valueIfTrue : valueIfFalse
        // condition ? value1 : value2
        return  density > 12.91705 ? '#b30000' :
                density > 7.76944 ? '#e34a33' :
                density > 3.193155 ? '#fc8d59' :
                density > -2.927277 ? '#fdcc8a' :
                '#fef0d9';
    }

    // Set style function that sets fill color property equal to percentage of rural population
    function style(feature) {
        return {
            fillColor: setColor(feature.properties.Migration),
            fillOpacity: 0.5,
            weight: 2,
            opacity: 0.8,
            color: '#605f5f',
            dashArray: '4'
        };
    }

    var counties_netmigration_choropleth = L.geoJson.ajax('../../assets/counties.geojson',
        {
            style: style,
            onEachFeature: function (feature, layer) {
                layer.bindTooltip(feature.properties.altName+"<br> Net Migration: "+ (feature.properties.Migration).toFixed(2), {className: 'feature-label', permanent: false, direction: 'center'});
            }
        });


    var counties_netmigration_choropleth_legend = '<p><b>Net Migration</b></p>' +
        '<i style="background: #fef0d9; opacity: 0.5"></i><p><b>-7.18 - -2.93</b></p>' +
        '<i style="background: #fdcc8a; opacity: 0.5"></i><p><b>-2.92 - 3.19</b></p>' +
        '<i style="background: #fc8d59; opacity: 0.5"></i><p><b>3.20 - 7.77</b></p>' +
        '<i style="background: #e34a33; opacity: 0.5"></i><p><b>7.78 - 12.92</b></p>'+
        '<i style="background: #b30000; opacity: 0.5"></i><p><b>>12.93</b></p>';

    //////////////////////////////////////////////////////////////////////////
    // Scene 5: Housing Cost Burden


        // Set function for color ramp
        function setColor(density){
            //Tenary operation: condition ? valueIfTrue : valueIfFalse
            // condition ? value1 : value2
            return  density > 38.111159 ? '#b30000' :
                    density > 34.546092 ? '#e34a33' :
                    density > 31.156108 ? '#fc8d59' :
                    density > 26.767134 ? '#fdcc8a' :
                    '#fef0d9';
        }

        // Set style function that sets fill color property equal to the housing cost burden
        function style(feature) {
            return {
                fillColor: setColor(feature.properties.Housing_Co),
                fillOpacity: 0.5,
                weight: 2,
                opacity: 0.8,
                color: '#605f5f',
                dashArray: '4'
            };
        }

        var counties_hcb_choropleth = L.geoJson.ajax('../../assets/counties.geojson',
            {
                style: style,
                onEachFeature: function (feature, layer) {
                    layer.bindTooltip(feature.properties.altName+"<br> Housing Cost Burden: "+ (feature.properties.Housing_Co).toFixed(2)+ "%", {className: 'feature-label', permanent: false, direction: 'center'});
                }
            });


        var counties_hcb_choropleth_legend = '<p><b>Net Migration</b></p>' +
            '<i style="background: #fef0d9; opacity: 0.5"></i><p><b>23.02 - 26.77</b></p>' +
            '<i style="background: #fdcc8a; opacity: 0.5"></i><p><b>26.78 - 31.16</b></p>' +
            '<i style="background: #fc8d59; opacity: 0.5"></i><p><b>31.17 - 34.55</b></p>' +
            '<i style="background: #e34a33; opacity: 0.5"></i><p><b>34.56 - 38.11</b></p>'+
            '<i style="background: #b30000; opacity: 0.5"></i><p><b>>38.12</b></p>';

    //////////////////////////////////////////////////////////////////////////
    // Scene 6: circleMarker in glow effects

    var towers_circle2 = L.geoJson.ajax('../../assets/cell_towers.geojson', {
        pointToLayer: function (feature, latlng) {
            //return L.circle(latlng, 1000 * Math.pow(Math.floor((Math.random() * 3) + 1), 2));
            return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-one-fine-smaller-dot glow-effect'})});
        },
        onEachFeature: function (feature, layer) {
            layer.bindTooltip(feature.properties.Name, {sticky: true, className: "feature-tooltip"});
        }
    });

    var towers_circle2_legend ='<i class=""><svg height="16" width="16"> <circle cx="8" cy="8" r="6" stroke="white" stroke-width="0" fill="#00ff00" fillOpacity="0.4" /> </svg></i><p><b>Tower</b></p>';

    var darkLayer = L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png');

    //////////////////////////////////////////////////////////////////////////

    var layers = {
        'counties': [counties, counties_legend],
        'counties_choropleth': [ counties_choropleth, counties_choropleth_legend],
        'towers': [counties_ruralpop_choropleth, counties_ruralpop_choropleth_legend],
        'towers_color': [counties_netmigration_choropleth, counties_netmigration_choropleth_legend],
        'towers_circle': [counties_hcb_choropleth, counties_hcb_choropleth_legend],
        'towers_circle2': [towers_circle2, towers_circle2_legend],
        'darkLayer': [darkLayer]
    };


    var scenes = {
        scene1: {lat: 44, lng: -123.5, zoom: 7, name: 'Plain', layers: ['counties']},
        scene2: {lat: 44, lng: -123.5, zoom: 7, name: 'Choropleth', layers: ['counties_choropleth']},
        scene3: {lat: 44, lng: -123.5, zoom: 7, name: 'towers', layers: ['towers']},
        scene4: {lat: 44, lng: -123.5, zoom: 7, name: 'towers categorized by companies', layers: ['towers_color']},
        scene5: {lat: 44, lng: -123.5, zoom: 7, name: 'tower circles', layers: ['towers_circle']},
        scene6: {lat: 44, lng: -123.5, zoom: 7, name: 'tower circles', layers: ['towers_circle2', 'darkLayer']}
    };

    $('.main').storymap({
        scenes: scenes,
        layers: layers,
        legend: true, // if you do not want a legend feature, you can simply not define the createLegend function.
        scale: false,
        navwidget: true,
        createMap: function () {
            // create a map in the "map" div, set the view to a given place and zoom
            var map = L.map('map', {zoomControl: false, scrollWheelZoom: false});

            // add an base map, which can be either OSM, mapbox, tilelayer, wmslayer or those designed by yourself.
            L.tileLayer('http://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png').addTo(map);

            // hidden the credits, but show in the about page.
            $(".leaflet-control-attribution").css("display", "none");
            return map;
        }
    });
</script>
</body>
</html>
